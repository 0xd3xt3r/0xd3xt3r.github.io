<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Hacking strace for System Call Instrumentation - Tainted Bits</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Tainted Bits"><meta name="msapplication-TileImage" content="/images/logo-header.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Tainted Bits"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="I was always fascinated by projects like Unicorn Engine and Capstone Engine where the author repurposed existing software development tools, such as QEMU and LLVM, for Software Security. While working"><meta property="og:type" content="article"><meta property="og:title" content="Hacking strace for System Call Instrumentation"><meta property="og:url" content="https://www.taintedbits.com/2024/09/29/hacking-strace-for-system-call-instrumentation/"><meta property="og:site_name" content="Tainted Bits"><meta property="og:description" content="I was always fascinated by projects like Unicorn Engine and Capstone Engine where the author repurposed existing software development tools, such as QEMU and LLVM, for Software Security. While working"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.taintedbits.com/img/og_image.png"><meta property="article:published_time" content="2024-09-28T18:30:00.000Z"><meta property="article:modified_time" content="2024-10-02T12:59:51.455Z"><meta property="article:author" content="D3xt3r"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Tracing"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://www.taintedbits.com/img/og_image.png"><meta property="twitter:creator" content="@0xd3xt3r"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.taintedbits.com/2024/09/29/hacking-strace-for-system-call-instrumentation/"},"headline":"Hacking strace for System Call Instrumentation","image":["https://www.taintedbits.com/img/og_image.png"],"datePublished":"2024-09-28T18:30:00.000Z","dateModified":"2024-10-02T12:59:51.455Z","author":{"@type":"Person","name":"D3xt3r"},"publisher":{"@type":"Organization","name":"Tainted Bits","logo":{"@type":"ImageObject","url":"https://www.taintedbits.com/images/logo-header.png"}},"description":"I was always fascinated by projects like Unicorn Engine and Capstone Engine where the author repurposed existing software development tools, such as QEMU and LLVM, for Software Security. While working"}</script><link rel="alternate" href="/atom.xml" title="Tainted Bits" type="application/atom+xml"><link rel="icon" href="/images/logo-header.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/railscasts.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><!--!--><script src="https://www.googletagmanager.com/gtag/js?id=UA-128181439-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-128181439-1');</script><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo-header.png" alt="Tainted Bits" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/publications">Publication</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/0xd3xt3r"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-09-28T18:30:00.000Z" title="29/9/2024, 12:00:00 am">2024-09-29</time></span><span class="level-item"><a class="link-muted" href="/categories/Reverse-Engineering/">Reverse Engineering</a></span></div></div><h1 class="title is-3 is-size-4-mobile">Hacking strace for System Call Instrumentation</h1><div class="content"><p>I was always fascinated by projects like <a target="_blank" rel="noopener" href="https://www.unicorn-engine.org/">Unicorn Engine</a> and <a target="_blank" rel="noopener" href="https://www.capstone-engine.org/">Capstone Engine</a> where the author repurposed existing software development tools, such as QEMU and LLVM, for Software Security. While working on Reverse Engineering a binary in the MIPS WiFi Router. I needed to intercept and manipulate Syscall data exchange between router application with a kernel driver. I couldn’t find any open-source tool that could do that for MIPS architecture, then it stuck me that was the perfect opportunity to do something like Unicorn project.</p>
<span id="more"></span>
<p>I was already using <a target="_blank" rel="noopener" href="https://strace.io">strace</a> to monitor the syscalls for the Router binary. However, I could not modify the Syscall parameter value or write a parser for the IOCTL of the custom drivers. Since strace already traces Syscalls well, it also parses known Syscall parameters and return values and it is open source. I thought, what if I could patch it? what if I can get a callback before and after each Syscall. This callback should allow me to modify and trace Syscall parameters and return values.</p>
<p>That been said, there where many other reason for choosing this tool which are as follows:</p>
<ol>
<li>strace has a huge amount of code that parses the syscall parameters and various IOCTLs. I wanted to reuse much of my team’s hard work.</li>
<li>It has been around for a long time and supports many architectures, and even many embedded Linux build systems such as Yocto and Buildroot can build strace.</li>
<li>Another key feature of strace is the tracing multi-threaded programs and forked processes.</li>
<li>If I did this myself using ptrace, it would take a long time to develop, debug, and test it, that would be a lot of code to maintain. I didn’t want to recreate many things that strace already provides. I really didn’t have the patience for that.</li>
<li>Finally, I only wanted to write code to advance my Reverse Engineering project. Call me selfish/lazy, but I would like to call it “not losing focus.”</li>
</ol>
<h2 id="System-Requirements"><a class="header-anchor" href="#System-Requirements">#</a>System Requirements</h2>
<p>Before we jump into strace source code or any sort of coding, let us define what we are we trying to achieve here. Below I have listed some of the requirements of the system I initially had in mind:</p>
<ol>
<li>To did not wanted to make too many changes to the strace codebase. I want to create some sort of plugin architecture. This would make the project more portable to any version of the strace.</li>
<li>The plugin will have the core logic of tracing or manipulating Syscall data, and the plugin will be compiled as a shared library.</li>
<li>strace will take plugin path as a command-line option, which it will load and invoke the callback function for before/after each Syscall.</li>
<li>The plugin defines the following interfaces/functions:
<ol>
<li><strong>Setup Callback:</strong> This function is invoked once the plugin library is loaded by strace. To export the Syscall data or to accept any command from another process, you have to initialize resources like IPC, or File, Network socket, etc., and this lifecycle function will give you an opportunity to initialize those resources.</li>
<li><strong>Teardown Callback:</strong> This function is invoked before the plugin library is unloaded. It complements the previous function, and you are supposed to release all the resources you have created in the setup phase.</li>
<li><strong>Syscall Entry Callback:</strong> This function is invoked before every syscall. This callback is an opportunity to identify the Syscall number and its parameter type and take appropriate action.</li>
<li><strong>Syscall Exit Callback:</strong> This function is invoked once the Syscall returns , and this is where you can see the result of the syscall execution either in the Register (which is defined by the <em>System Calling Convention</em>) or memory pointer in one of the syscall parameters.</li>
</ol>
</li>
</ol>
<h2 id="Brief-introduction-to-ptrace-syscalls"><a class="header-anchor" href="#Brief-introduction-to-ptrace-syscalls">#</a>Brief introduction to ptrace syscalls</h2>
<p>If you already know how ptrace API work, then this section can serve a quick refresher or you can just skip it.</p>
<p>The <a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man2/ptrace.2.html">ptrace syscall</a> sub-system provides a way by which one process(the “debugger”) can observer and control the execution of another process(the “debuggee/tracee”). You can write you own debugger using this API’s, even the mainstream debuggers such as GDB, LLDB, etc use them internally.</p>
<p>The ptrace syscall work in an event loop pattern. In this method you launch a new program(the “tracee”) under ptrace syscall this way kernel give the “debugger” process to control the “tracee” process. While spawning the process we mention the type of events you want the debugger process to be notified. This is done with <strong>PTRACE_SETOPTIONS</strong> syscall, the list of supported events can be found on the ptrace <a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man2/ptrace.2.html">man page</a>.</p>
<p>The debugger event loop is blocked with <a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man2/waitpid.2.html">wait</a> system call, waiting on the tracee process. The wait4 syscall returns once it has the event to process and makes additional ptrace syscall to gather more information about the event.</p>
<p>This is what a very high level working of ptrace syscall looks like. We now how to find this pattern in the strace codebase.</p>
<p>To find syscall entry/exit point we need to find the function which is processing these events.</p>
<h2 id="Source-Code-Exploration"><a class="header-anchor" href="#Source-Code-Exploration">#</a>Source Code Exploration</h2>
<p>Let’s get our hands dirty, you can download the code from <a target="_blank" rel="noopener" href="https://github.com/strace/strace/">official strace repoistory</a>.</p>
<p>We have already defined the goal in the previous section, to achieve we need to do the following:</p>
<ol>
<li>Add a command line argument which takes the library path in strace. Loads the library from that path and finds the interface function mentioned previously in the requirement section.</li>
<li>Identify the point in the strace code which processes Syscall enter and exit event. It is at this point we will invoke our syscall entry/exit callback functions which are present in the plugin library.</li>
<li>Figure out how to trace multiple threads and processes.</li>
<li>Find the points at which we will call the resource setup &amp; teardown callbacks.</li>
</ol>
<p>The first objective is pretty easy. We have to search for code which is doing command-line parsing and add one more option to it, it should be somewhere near the <em>main function</em>. Below, is the code section where my search landed me, I have also added comments on what needs to be done.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/strace.c</span></span><br><span class="line"><span class="comment">// traced from main() -&gt; init()</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> ATTRIBUTE_NOINLINE</span><br><span class="line"><span class="title function_">init</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// code is skipped</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// add the command value data type &quot;:l&quot; at the end of this string</span></span><br><span class="line">  <span class="comment">// is will added string option</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">char</span> optstring[] =</span><br><span class="line">      <span class="string">&quot;+a:Ab:cCdDe:E:fFhiI:kno:O:p:P:qrs:S:tTu:U:vVwxX:yYzZ&quot;</span>;</span><br><span class="line">  <span class="comment">// code is skipped</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// pretty standard &#x27;getopt&#x27; library function parsing one command line parameter</span></span><br><span class="line">  <span class="comment">// at a time</span></span><br><span class="line">  <span class="keyword">while</span> ((c = getopt_long(argc, argv, optstring, longopts, &amp;lopt_idx)) != EOF) &#123;</span><br><span class="line">		<span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">option</span> *<span class="title">lopt</span> =</span> lopt_idx &gt;= <span class="number">0</span></span><br><span class="line">			&amp;&amp; (<span class="type">unsigned</span>) lopt_idx &lt; ARRAY_SIZE(longopts)</span><br><span class="line">			? longopts + lopt_idx : <span class="literal">NULL</span>;</span><br><span class="line">		lopt_idx = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">switch</span> (c) &#123;</span><br><span class="line">      <span class="comment">// add one more command option here.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">usage</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// code is skipped</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// you have add some help string for the plugin path</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\</span></span><br><span class="line"><span class="string">  // lot more code is skipped</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Miscellaneous:\n\</span></span><br><span class="line"><span class="string">  -d, --debug    enable debug output to stderr\n\</span></span><br><span class="line"><span class="string">  -l [lib path]  you fancy plugin path please!</span></span><br><span class="line"><span class="string">  &quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now on to the main part, the code which is processing the ptrace event loop. We can start by searching for ptrace event constants like PTRACE_EVENT_EXEC, PTRACE_EVENT_FORK, etc(“PTRACE_EVENT_*”). These constants are somewhere around <em>wait</em> syscall which is basically the Syscall that brings these events to the debugger process. Or you could directly search for the <em>wait</em> syscall. Both of these code snippets will be near to each other. By taking either path you will reach <strong>next_event</strong> function.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/strace.c</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="keyword">struct</span> tcb_wait_data *<span class="title function_">next_event</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> pid = wait4(<span class="number">-1</span>, &amp;status, __WALL, (cflag ? &amp;ru : <span class="literal">NULL</span>));</span><br><span class="line">  <span class="comment">//CODE SKIPPED</span></span><br><span class="line">  			<span class="keyword">switch</span> (event) &#123;</span><br><span class="line">          <span class="comment">// CODE SKIPPED</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> PTRACE_EVENT_STOP:</span><br><span class="line">          <span class="comment">// CODE SKIPPED</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>By quickly skimming through the function code I could conclude that it is parsing the <em>tracee</em> process debug event information into a <em>tcb_wait_data</em> struct, which is also the return type of the function. The return value is then passed as a parameter to <em>dispatch_event</em> function. And, the name of the function name also suggests that it must be processing some events, most likely debugging. So, I started to investigate <em>dispatch_event</em> function.</p>
<p>While reading the function code I came across a switch block, with one of the case labelled as <strong>TE_SYSCALL_STOP</strong> which looked interesting to me. Investigating that case further, I reached <strong>trace_syscall</strong> function, which is where I concluded my search for Syscall enter and exit. It does the processing of both Syscall entry and exit event, it also does Syscall parameter decoding and stores it in <code>struct tcb</code>.</p>
<p>The code for that function is shown below, it looks like the point to invoke our Syscall callback.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/strace.c</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">trace_syscall</span><span class="params">(<span class="keyword">struct</span> tcb *tcp, <span class="type">unsigned</span> <span class="type">int</span> *sig)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (entering(tcp)) &#123;</span><br><span class="line">    <span class="comment">// this if block has all the syscall enter related logic</span></span><br><span class="line">		<span class="type">int</span> res = syscall_entering_decode(tcp);</span><br><span class="line">		<span class="keyword">switch</span> (res) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			res = syscall_entering_trace(tcp, sig);</span><br><span class="line">		&#125;</span><br><span class="line">		syscall_entering_finish(tcp, res);</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// this else block has all the syscall exit related logic</span></span><br><span class="line">		<span class="keyword">struct</span> timespec ts = &#123;&#125;;</span><br><span class="line">		<span class="type">int</span> res = syscall_exiting_decode(tcp, &amp;ts);</span><br><span class="line">		<span class="keyword">if</span> (res != <span class="number">0</span>) &#123;</span><br><span class="line">			res = syscall_exiting_trace(tcp, &amp;ts, res);</span><br><span class="line">		&#125;</span><br><span class="line">		syscall_exiting_finish(tcp);</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The cherry on top is strace makes our job easier if you read <code>struct tcb</code>. Many of the fields suggest that strace already extracts the Syscall value and the parameters into a proper data type. This will make our patch work in any architecture which strace support.<br />
If it weren’t for this structure, I would have had to write the ptrace syscall to read/write Register/Memory values, which would make it architecture-dependent, and this would require a lot more effort.</p>
<p>The <em>pid</em> field in the <code>struct tcb</code> identifies the thread making the Syscall. This field will fulfil our requirement to trace multiple threads/processes. The <em>tcb</em> struct is huge and not all the fields are relevant to our requirement. So in the below code block, I have highlighted only the fields which are useful.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/defs.h</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tcb</span> &#123;</span></span><br><span class="line">	<span class="type">int</span> flags;		<span class="comment">/* See below for TCB_ values */</span></span><br><span class="line">	<span class="type">int</span> pid;		<span class="comment">/* If 0, this tcb is free */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">kernel_ulong_t</span> scno;	<span class="comment">/* System call number */</span></span><br><span class="line">	<span class="type">kernel_ulong_t</span> true_scno;	<span class="comment">/* Same, but without subcall decoding and shuffling */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">kernel_ulong_t</span> u_arg[MAX_ARGS];	<span class="comment">/* System call arguments */</span></span><br><span class="line">	<span class="type">kernel_long_t</span> u_rval;	<span class="comment">/* Return value */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> sys_func_rval;	<span class="comment">/* Syscall entry parser&#x27;s return value */</span></span><br><span class="line">	</span><br><span class="line">	FILE *outf;		<span class="comment">/* Output file for this process */</span></span><br><span class="line">  <span class="comment">// CODE SKIPPED</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Next, regarding the Resource setup &amp; teardown callback function. We can call the resource setup function after the command-line parsing is done, and the resource teardown function can be called just before the main function returns. Shared library loading should be simple call <strong>dlopen</strong>. To find callback function pointers can be done using <strong>dlsym</strong>.</p>
<p>OK, Fellas that is all we need, next we will define the plugin interface.</p>
<h2 id="Plugin-Interface"><a class="header-anchor" href="#Plugin-Interface">#</a>Plugin Interface</h2>
<p>The requirment was mentioned in the start of the blog below the code which materiazled those idea.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Function prototype for Syscall entry/exit callback</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span> <span class="params">(*syscall_func)</span><span class="params">(<span class="keyword">struct</span> tcb *syscall_data)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// function prototype for Plugin load/unload callback</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span> <span class="params">(*plugin_func)</span><span class="params">(<span class="type">void</span> *data)</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">plugin_ops</span> &#123;</span></span><br><span class="line">  <span class="comment">// callback function invoked before the syscall</span></span><br><span class="line">  syscall_func entry;</span><br><span class="line">  <span class="comment">// callback function invoked after the syscall</span></span><br><span class="line">  syscall_func <span class="built_in">exit</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// callback function invoked one the plugin is loaded</span></span><br><span class="line">  plugin_func load;</span><br><span class="line">  <span class="comment">// callback function invoked one the before the plugin is unloaded</span></span><br><span class="line">  plugin_func unload;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>If you are going to do anything serious with your plugin, it’s inevitable that you will have to do memory read/write in the tracee process. To do this you can either use ptrace PTRACE_POKETEXT/PTRACE_PEEKDATA Syscall, or you can use a more modern alternative which is <em>process_vm_readv</em>/<em>process_vm_writev</em> Syscall. Either way, you will have to deal with architecture-dependent code. Or, you can dig more into the code base and figure out how strace is doing it and, how you can reuse some of that good stuff.</p>
<h2 id="System-call-number-identification-problem"><a class="header-anchor" href="#System-call-number-identification-problem">#</a>System call number identification problem</h2>
<p>Another interesting fact I discovered about the Linux Syscall interface while working on this project is that it has a standard Syscall interface, which doesn’t change across kernel versions. This ensures unconditional backward compatibility. But, across different architecture, the Syscall number is different. So, for example, a <em>read</em> Syscall number will be consistent across different Linux versions in x86 architecture, but for other architectures, like MIPS, ARM, etc, the number might differ.</p>
<p>You can find the Syscall number for all the different architecture <a target="_blank" rel="noopener" href="https://gpages.juszkiewicz.com.pl/syscalls-table/syscalls.html">here</a>. If you observe the table, you will notice that not all syscalls are present in all the architecture. For example, getxgid, getxpid &amp; getxuid syscalls are present only in alpha architecture.</p>
<p>The reason I am discussing this is because, when you start writing a Syscall-specific code, using the syscall number from an internet search won’t work. That’s because the strace has its own Syscall number convention.</p>
<p>The problem is, that different syscall numbers for different architectures can make your code very architecture-dependent. And, to deal with this issue strace uses a very clever technique, they created their Syscall number. Then, for each architecture they map the architecture-specific Syscall number to strace’s won syscall number. You can find this mapping for each architecture in the “linux/<arch>/syscallent.h” file.</p>
<h2 id="Some-interesting-notes-about-strace-code"><a class="header-anchor" href="#Some-interesting-notes-about-strace-code">#</a>Some interesting notes about strace code</h2>
<p>Some interesting things were found while I was navigating the code.</p>
<ol>
<li>The bulk of code in strace is regarding parsing the Syscall parameters and return value. The parsing code can be found in the file by the “<syscall name>.c”.</li>
<li>The <em>defs.h</em> file has a lot of code which can be re-used, doing more research in this file can help you find more architecture-independent code.</li>
<li>Macro <code>SYS_FUNC</code> defines Syscall handling functions. For example, <em>read</em> syscall is defined <code>SYS_FUNC(read)</code> macro which expands to the code<code>int sys_read(struct tcb *tcp)</code> function. This handler code parses the syscall parameter and prints it on the console.</li>
<li>Metadata regarding each syscall stored in <code>struct_sysent</code> struct, there is an array of such struct describing each syscall. This struct also has a handler function pointer, which is described in the previous pointer. Below is the code for the structure.</li>
</ol>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">sysent</span> &#123;</span></span><br><span class="line">  <span class="type">unsigned</span> nargs;                 <span class="comment">// number of syscall arguments </span></span><br><span class="line">  <span class="type">int</span>	sys_flags;</span><br><span class="line">  <span class="type">int</span>	sen;                        <span class="comment">// syscall number</span></span><br><span class="line">  <span class="type">int</span>	(*sys_func)(<span class="keyword">struct</span> tcb *);  <span class="comment">// syscall decoding/parsing function</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *sys_name;           <span class="comment">// syscall name</span></span><br><span class="line">&#125; struct_sysent;</span><br></pre></td></tr></table></figure>
<h2 id="Conclusion"><a class="header-anchor" href="#Conclusion">#</a>Conclusion</h2>
<p>I was amazed at how easy it was to implement this, I would say most of the credit goes to the good programming standard and amazing readability of the project. The code documentation by means of variables, functions, struct names, comments, etc made it very easy to navigate the project.</p>
<p>In the post, we went from defining the system requirements to navigating the strace source to understanding how we can patch the code base to make our plugin work.</p>
<p>There is much more to explore in this project like tracing file descriptor resources like Socket, File, IPC, etc but I am going to end this post here, maybe it in another post.</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Linux/">Linux</a><a class="link-muted mr-2" rel="tag" href="/tags/Tracing/">Tracing</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/07/09/exploring-the-fundamentals-of-RISC-V-assembly-and-shellcode-series-part1/"><span class="level-item">Exploring the fundamentals of RISC-V: Assembly and Shellcode Series - Part 1</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://www.taintedbits.com/2024/09/29/hacking-strace-for-system-call-instrumentation/';
            this.page.identifier = '2024/09/29/hacking-strace-for-system-call-instrumentation/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'taintedbits' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#System-Requirements"><span class="level-left"><span class="level-item">1</span><span class="level-item">System Requirements</span></span></a></li><li><a class="level is-mobile" href="#Brief-introduction-to-ptrace-syscalls"><span class="level-left"><span class="level-item">2</span><span class="level-item">Brief introduction to ptrace syscalls</span></span></a></li><li><a class="level is-mobile" href="#Source-Code-Exploration"><span class="level-left"><span class="level-item">3</span><span class="level-item">Source Code Exploration</span></span></a></li><li><a class="level is-mobile" href="#Plugin-Interface"><span class="level-left"><span class="level-item">4</span><span class="level-item">Plugin Interface</span></span></a></li><li><a class="level is-mobile" href="#System-call-number-identification-problem"><span class="level-left"><span class="level-item">5</span><span class="level-item">System call number identification problem</span></span></a></li><li><a class="level is-mobile" href="#Some-interesting-notes-about-strace-code"><span class="level-left"><span class="level-item">6</span><span class="level-item">Some interesting notes about strace code</span></span></a></li><li><a class="level is-mobile" href="#Conclusion"><span class="level-left"><span class="level-item">7</span><span class="level-item">Conclusion</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-28T18:30:00.000Z">2024-09-29</time></p><p class="title"><a href="/2024/09/29/hacking-strace-for-system-call-instrumentation/">Hacking strace for System Call Instrumentation</a></p><p class="categories"><a href="/categories/Reverse-Engineering/">Reverse Engineering</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-09T07:17:02.000Z">2023-07-09</time></p><p class="title"><a href="/2023/07/09/exploring-the-fundamentals-of-RISC-V-assembly-and-shellcode-series-part1/">Exploring the fundamentals of RISC-V: Assembly and Shellcode Series - Part 1</a></p><p class="categories"><a href="/categories/Software-Exploitation/">Software Exploitation</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-02-14T18:30:00.000Z">2021-02-15</time></p><p class="title"><a href="/2021/02/15/arm-architecture-webinar/">ARM Architecture and Shellcode Webinars</a></p><p class="categories"><a href="/categories/Software-Exploitation/">Software Exploitation</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-07-17T18:30:00.000Z">2020-07-18</time></p><p class="title"><a href="/2020/07/18/binary-exploitation-pwnable-tw-tcache-tear/">Binary Exploitation [pwnable.tw] - Tcache Tear</a></p><p class="categories"><a href="/categories/Software-Exploitation/">Software Exploitation</a> / <a href="/categories/Software-Exploitation/CTF-Writeup/">CTF Writeup</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-07-11T18:30:00.000Z">2020-07-12</time></p><p class="title"><a href="/2020/07/12/binary-exploitation-pwnable-tw-caov/">Binary Exploitation [pwnable.tw] - CAOV</a></p><p class="categories"><a href="/categories/Software-Exploitation/">Software Exploitation</a> / <a href="/categories/Software-Exploitation/CTF-Writeup/">CTF Writeup</a></p></div></article></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Malware-Analysis/"><span class="level-start"><span class="level-item">Malware Analysis</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">11</span></span></a><ul><li><a class="level is-mobile" href="/categories/Programming/Data-Analysis/"><span class="level-start"><span class="level-item">Data Analysis</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/IoT-Dev/"><span class="level-start"><span class="level-item">IoT Dev</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Machine-Learning/"><span class="level-start"><span class="level-item">Machine Learning</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Reverse-Engineering/"><span class="level-start"><span class="level-item">Reverse Engineering</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Software-Exploitation/"><span class="level-start"><span class="level-item">Software Exploitation</span></span><span class="level-end"><span class="level-item tag">16</span></span></a><ul><li><a class="level is-mobile" href="/categories/Software-Exploitation/CTF-Writeup/"><span class="level-start"><span class="level-item">CTF Writeup</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ACS712/"><span class="tag">ACS712</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ARM-Reversing/"><span class="tag">ARM Reversing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Arduino/"><span class="tag">Arduino</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bare-Metal/"><span class="tag">Bare-Metal</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Chat-Bots/"><span class="tag">Chat Bots</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Classification/"><span class="tag">Classification</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Data-Analysis/"><span class="tag">Data Analysis</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Data-Wrangling/"><span class="tag">Data Wrangling</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dev/"><span class="tag">Dev</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dropper/"><span class="tag">Dropper</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ESP8266/"><span class="tag">ESP8266</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Editor/"><span class="tag">Editor</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Emacs/"><span class="tag">Emacs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Exploitation/"><span class="tag">Exploitation</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GandCrab/"><span class="tag">GandCrab</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Grey-Energy/"><span class="tag">Grey Energy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Heap-Exploitation/"><span class="tag">Heap Exploitation</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/IoT/"><span class="tag">IoT</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kernel-Debugging/"><span class="tag">Kernel Debugging</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux-Malware/"><span class="tag">Linux Malware</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Machine-Learning/"><span class="tag">Machine Learning</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Malware-Analysis/"><span class="tag">Malware Analysis</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NLP/"><span class="tag">NLP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RISC-V/"><span class="tag">RISC-V</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RISC-V-Shellcode/"><span class="tag">RISC-V-Shellcode</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROP/"><span class="tag">ROP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Regression/"><span class="tag">Regression</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reverse-Engineering/"><span class="tag">Reverse Engineering</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shellcode/"><span class="tag">Shellcode</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tracing/"><span class="tag">Tracing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Visualization/"><span class="tag">Visualization</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WarGames/"><span class="tag">WarGames</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows-Malware/"><span class="tag">Windows Malware</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows-Reversing/"><span class="tag">Windows Reversing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/glibc/"><span class="tag">glibc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript-obfuscation/"><span class="tag">javascript obfuscation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwnable/"><span class="tag">pwnable</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwnable-kr/"><span class="tag">pwnable-kr</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwnable-tw/"><span class="tag">pwnable-tw</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/radare2/"><span class="tag">radare2</span><span class="tag">4</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/logo-header.png" alt="Tainted Bits" height="28"></a><p class="is-size-7"><span>&copy; 2024 D3xt3r</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by-sa/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Subscribe" href="https://mailchi.mp/d744c1f04904/taintedbits"><i class="fa fa-envelope"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/0xd3xt3r"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>